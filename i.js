/**
 * Alright reservered
 * author: Le Minh Son, sitename.com
 */
"use strict";function _toConsumableArray(r){return _arrayWithoutHoles(r)||_iterableToArray(r)||_unsupportedIterableToArray(r)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var e=Object.prototype.toString.call(r).slice(8,-1);return"Object"===e&&r.constructor&&(e=r.constructor.name),"Map"===e||"Set"===e?Array.from(e):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?_arrayLikeToArray(r,a):void 0}}function _iterableToArray(r){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(r))return Array.from(r)}function _arrayWithoutHoles(r){if(Array.isArray(r))return _arrayLikeToArray(r)}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=new Array(a);e<a;e++)n[e]=r[e];return n}function _instanceof(r,a){return null!=a&&"undefined"!=typeof Symbol&&a[Symbol.hasInstance]?!!a[Symbol.hasInstance](r):r instanceof a}function Bezier(r,a,e,n,t,u){var o,i,s,l,f,g,m,c,b,p,h,y,d;if(null==t&&(t=0),null==u&&(u=255),_instanceof(r[0],Array)?(s=r,t=a,u=e):s=[r,a,e,n],s.length<2)throw"Invalid number of arguments to bezier";for(o={},m=function(r,a,e){return r*(1-e)+a*e},i=function(r,a,e){return Math.min(Math.max(r,a),e)},f=h=0;h<1e3;f=++h){for(p=f/1e3,b=s;b.length>1;){for(c=[],g=y=0,d=b.length-2;0<=d?y<=d:y>=d;g=0<=d?++y:--y)c.push([m(b[g][0],b[g+1][0],p),m(b[g][1],b[g+1][1],p)]);b=c}o[Math.round(b[0][0])]=Math.round(i(b[0][1],t,u))}return null==(o=MissingValues(o,l=s[s.length-1][0]))[l]&&(o[l]=o[l-1]),o}function MissingValues(r,a){var e,n,t,u,o,i,s;if(Object.keys(r).length<a+1){for(u={},e=i=0;0<=a?i<=a:i>=a;e=0<=a?++i:--i)if(null!=r[e])u[e]=r[e];else{for(t=[e-1,u[e-1]],n=s=e;e<=a?s<=a:s>=a;n=e<=a?++s:--s)if(null!=r[n]){o=[n,r[n]];break}u[e]=t[1]+(o[1]-t[1])/(o[0]-t[0])*(e-t[0])}return u}return r}function Clamp(r,a,e){return r>e?e:r<a?a:r}function Curves(){var r,a,e,n,t,u,o,i,s,l,f;if(e=arguments[0],(n=2<=arguments.length?[].slice.call(arguments,1):[])[n.length-1],r=Bezier,"string"==typeof e&&(e=e.split("")),a=r(n,0,255),(o=n[0])[0]>0)for(u=i=0,l=o[0];0<=l?i<l:i>l;u=0<=l?++i:--i)a[u]=o[1];if((t=n[n.length-1])[0]<255)for(u=s=f=t[0];f<=255?s<=255:s>=255;u=f<=255?++s:--s)a[u]=t[1];return function(r){var n,t;for(u=n=0,t=e.length;0<=t?n<t:n>t;u=0<=t?++n:--n)r[e[u]]=a[r[e[u]]];return r}}var Saturation=function(r){return r*=-.01,function(a){var e=Math.max(a.r,a.g,a.b);return a.r!==e&&(a.r+=Math.round((e-a.r)*r)),a.g!==e&&(a.g+=Math.round((e-a.g)*r)),a.b!==e&&(a.b+=Math.round((e-a.b)*r)),a}};function Brightness(r){for(var a=new Array(256),e=0;e<256;e++)a[e]=Clamp(e*(1+r),0,255);return function(r){return r.r=a[r.r],r.g=a[r.g],r.b=a[r.b],r}}var CamanGamma=function(r){return function(a){return a.r=255*Math.pow(a.r/255,r),a.g=255*Math.pow(a.g/255,r),a.b=255*Math.pow(a.b/255,r),a}};function Channels(r){var a;for(a in console.log("options: ",r),r)0!==r[a]?r[a]/=100:delete r[a];return function(a){return r.red&&(r.red>0?a.r+=(255-a.r)*r.red:a.r-=a.r*Math.abs(r.red)),r.green&&(r.green>0?a.g+=(255-a.g)*r.green:a.g-=a.g*Math.abs(r.green)),r.blue&&(r.blue>0?a.b+=(255-a.b)*r.blue:a.b-=a.b*Math.abs(r.blue)),a}}var SepiaCaman=function(r){return r/=100,function(a){return a.r=Math.min(255,a.r*(1-.607*r)+a.g*(.769*r)+a.b*(.189*r)),a.g=Math.min(255,a.r*(.349*r)+a.g*(1-.314*r)+a.b*(.168*r)),a.b=Math.min(255,a.r*(.272*r)+a.g*(.534*r)+a.b*(1-.869*r)),a}},Colorize=function(r,a){return function(e){return e.r-=(e.r-r.r)*(a/100),e.g-=(e.g-r.g)*(a/100),e.b-=(e.b-r.b)*(a/100),e}};function GreyScale(){return function(r){var a=.299*r.r+.587*r.g+.114*r.b;return r.r=a,r.g=a,r.b=a,r}}var createStore=function(){var r;return{getBackupImgData:function(){return r},setBackupImgData:function(a){var e=a.width,n=a.height,t=a.data;for(var u in r=new ImageData(e,n),t)r.data[u]=t[u]}}},store=createStore(),filterMap={gameron:[{use:CamanGamma,params:[1.6]}],charm:[{use:Channels,params:[{red:8,blue:8}]}],javana:[{use:Saturation,params:[-35]},{use:Curves,params:["b",[20,0],[90,120],[186,144],[255,230]]},{use:Curves,params:["r",[0,0],[144,90],[138,120],[255,255]]},{use:Curves,params:["g",[10,0],[115,105],[148,100],[255,248]]},{use:Curves,params:["rgb",[0,0],[120,100],[128,140],[255,255]]}],sepiana:[{use:SepiaCaman,params:[50]}],vintage:[{use:GreyScale,params:[]},{use:SepiaCaman,params:[40]},{use:Channels,params:[{red:8,blue:2,green:4}]},{use:CamanGamma,params:[.87]}],bright:[{use:Brightness,params:[.25]}],dawn:[{use:Colorize,params:[{r:255,g:205,b:59},10]},{use:CamanGamma,params:[1.2]}]};function doFilter(r){if(r=r.toLowerCase().trim()){var a=store.getBackupImgData();if(a){if("original"===r||!filterMap[r])return a;for(var e=a.width,n=a.data,t=a.height,u=new ImageData(e,t),o=filterMap[r].map(function(r){return r.use.apply(r,_toConsumableArray(r.params))}),i=function(r){var a={r:n[r],g:n[r+1],b:n[r+2],a:n[r+3]};o.forEach(function(r){a=r(a)}),u.data[r]=a.r,u.data[r+1]=a.g,u.data[r+2]=a.b,u.data[r+3]=a.a},s=0;s<n.length;s+=4)i(s);return u}return null}return null}onmessage=function(r){var a=r.data,e=a.imgData,n=a.filterName;if(e&&store.setBackupImgData(e),n){var t=doFilter(n);this.postMessage({result:t})}};
